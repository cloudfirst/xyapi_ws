FROM ubuntu:18.04

# install Python3 
RUN apt-get update \
  && apt-get install -y python3-pip python3-dev \
  && cd /usr/local/bin \
  && ln -s /usr/bin/python3 python \
  && pip3 install --upgrade pip

# install all required python libs
COPY requirements.txt /tmp/
WORKDIR /tmp
RUN pip install -r requirements.txt

# create USER sinobot and needed directories
RUN useradd -m sinobot
RUN mkdir -p /usr/local/xyapi_ws || true && \
    mkdir -p /media/data || true && \
    mkdir -p /var/log/sinyi || true
RUN chown -R sinobot:sinobot /usr/local/xyapi_ws && \
    chmod 755 /usr/local/xyapi_ws && \
    chown -R sinobot:sinobot /var/log/sinyi && \
    chmod 755 -R 

# install OpenCV 4.0

# install Tesseract 4.0

# install supervisor for managing flask app daemon
RUN apt-get -y install supervisor
RUN rm -rf /var/lib/apt/lists/* && \
    sed -i 's/^\(\[supervisord\]\)$/\1\nnodaemon=true/' /etc/supervisor/supervisord.conf

# Define mountable directories.
VOLUME ["/etc/supervisor/conf.d"]
# Define working directory.
WORKDIR /etc/supervisor/conf.d

# Define default command.
CMD ["supervisord", "-c", "/etc/supervisor/supervisord.conf"]